<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç•™å®ˆç³»çµ± - å¢æ—ç®¡ç†å¾Œå°</title>
    <style>
        :root {
            --primary-color: #0078ff;
            --danger-color: #e61e1e;
            --success-color: #28a745;
            --bg-color: #f4f7f6;
        }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; padding: 20px; background: var(--bg-color); line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            margin-bottom: 20px; 
        }
        h2 { color: #333; margin-top: 0; border-left: 5px solid var(--primary-color); padding-left: 10px; font-size: 1.2rem; }
        p { color: #666; font-size: 0.9rem; }
        
        /* è¡¨å–®å…ƒç´  */
        label { display: block; margin: 10px 0 5px; font-weight: bold; color: #444; }
        select, input[type="file"] { 
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; 
        }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { 
            width: 100%; padding: 12px; border: none; border-radius: 6px; 
            cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 10px;
        }
        .btn-upload { background: var(--primary-color); color: white; }
        .btn-upload:hover { background: #0056b3; }
        .btn-danger { background: white; color: var(--danger-color); border: 1px solid var(--danger-color); }
        .btn-danger:hover { background: var(--danger-color); color: white; }
        
        /* é–‹é—œæ¨£å¼ (Switch) */
        .switch-group { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px f8f8f8 solid; }
        .status-msg { margin-top: 10px; font-size: 13px; font-weight: bold; text-align: center; min-height: 20px; }

        /* åˆ†éš”ç·š */
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 480px) {
            body { padding: 10px; }
            .card { padding: 15px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 20px;">
        <h1 style="margin-bottom: 5px;">â›°ï¸ ç•™å®ˆç®¡ç†ç³»çµ±</h1>
        <p>æ§åˆ¶ç«¯ç‰ˆæœ¬ 2.0 - è¡›æ˜Ÿé›™è»Œç›£æ§</p>
    </div>

    <div class="card">
        <h2>1. èˆªè·¡ (GPX) ç®¡ç†</h2>
        <p>ç›®å‰åœ°åœ–ä½¿ç”¨çš„ GPXï¼š<strong id="current-gpx" style="color: var(--primary-color);">è¼‰å…¥ä¸­...</strong></p>
        
        <label>é¸æ“‡å·²æœ‰è»Œè·¡ï¼š</label>
        <select id="gpx-list" onchange="changeGpx(this.value)">
            <option value="å°åŒ—å¤§ç¸±èµ°.gpx">å°åŒ—å¤§ç¸±èµ°.gpx</option>
            <option value="ç‰å±±ä¸»å³°.gpx">ç‰å±±ä¸»å³°.gpx</option>
            <option value="é›ªå±±ä¸»æ±.gpx">é›ªå±±ä¸»æ±.gpx</option>
        </select>

        <hr>
        <label>ä¸Šå‚³æ–° GPX æª”æ¡ˆï¼š</label>
        <input type="file" id="gpx-file" accept=".gpx">
        <button class="btn btn-upload" onclick="uploadGpx()">ç¢ºèªä¸Šå‚³ä¸¦åˆ‡æ›</button>
        <div id="upload-status" class="status-msg"></div>
    </div>

    <div class="card">
        <h2>2. å³æ™‚é€šçŸ¥è½‰ç™¼ (LINE / TG)</h2>
        <p>ç•¶è¡›æ˜Ÿæ”¶åˆ°æ–°ä½ç½®æ™‚ï¼Œæ˜¯å¦åŒæ­¥ç™¼é€åˆ°ç¾¤çµ„ï¼š</p>
        
        <div class="switch-group">
            <span>LINE é€šçŸ¥æœå‹™</span>
            <input type="checkbox" id="enable-line" style="width: 20px; height: 20px;" onchange="updateNotifySettings()">
        </div>
        
        <div class="switch-group">
            <span>Telegram é€šçŸ¥æœå‹™</span>
            <input type="checkbox" id="enable-tg" style="width: 20px; height: 20px;" onchange="updateNotifySettings()">
        </div>
        
        <div id="notify-status" class="status-msg"></div>
    </div>

    <div class="card" style="border-top: 4px solid var(--danger-color);">
        <h2>3. æ•¸æ“šç®¡ç†</h2>
        <p>æ­¤å‹•ä½œå°‡æœƒæ¸…ç©º Google è©¦ç®—è¡¨å…§ **æ‰€æœ‰** çš„å›å ±ç´€éŒ„ (ä¿ç•™æ¨™é¡Œåˆ—)ã€‚</p>
        <button class="btn btn-danger" onclick="clearSheet()">âš ï¸ ä¸€éµæ¸…ç©ºæ‰€æœ‰å›å ±è³‡æ–™</button>
        <div id="sheet-status" class="status-msg"></div>
    </div>
</div>

<script>
    // âš ï¸ è«‹å¡«å…¥ä½ çš„ Google Apps Script (GAS) éƒ¨ç½²ç¶²å€
    const GAS_URL = 'ä½ çš„_GAS_éƒ¨ç½²ç¶²å€';

    // åˆå§‹è¼‰å…¥
    window.onload = function() {
        const savedGpx = localStorage.getItem('selectedGPX') || 'å°åŒ—å¤§ç¸±èµ°.gpx';
        document.getElementById('current-gpx').innerText = savedGpx;
        document.getElementById('gpx-list').value = savedGpx;

        // è®€å–æœ¬åœ°é–‹é—œç‹€æ…‹ (å¯¦å‹™ä¸Šæ‡‰å¾ GAS è®€å–ï¼Œæ­¤è™•ç‚ºç°¡åŒ–ç‰ˆ)
        document.getElementById('enable-line').checked = localStorage.getItem('line_active') === 'true';
        document.getElementById('enable-tg').checked = localStorage.getItem('tg_active') === 'true';
    };

    // 1. åˆ‡æ› GPX
    function changeGpx(val) {
        localStorage.setItem('selectedGPX', val);
        document.getElementById('current-gpx').innerText = val;
        alert('å·²åˆ‡æ›ï¼ç›£æ§é é¢é‡æ–°æ•´ç†å¾Œå°‡é¡¯ç¤ºæ–°è»Œè·¡ã€‚');
    }

    // 2. ä¸Šå‚³ GPX (æ¨¡æ“¬)
    function uploadGpx() {
        const fileInput = document.getElementById('gpx-file');
        const status = document.getElementById('upload-status');
        if (fileInput.files.length === 0) return alert('è«‹å…ˆé¸æ“‡ .gpx æª”æ¡ˆ');
        
        const fileName = fileInput.files[0].name;
        status.innerText = 'æ­£åœ¨è™•ç†æª”æ¡ˆ ' + fileName + '...';
        status.style.color = 'orange';
        
        setTimeout(() => {
            status.innerText = 'âœ… ä¸Šå‚³æˆåŠŸ (ç›®å‰ç‚ºæ¨¡æ“¬å­˜æª”)';
            status.style.color = 'green';
            changeGpx(fileName);
            // å‹•æ…‹åŠ å…¥é¸å–®
            const option = document.createElement('option');
            option.value = fileName; option.text = fileName;
            document.getElementById('gpx-list').add(option);
            document.getElementById('gpx-list').value = fileName;
        }, 1200);
    }

    // 3. æ›´æ–°é€šçŸ¥è¨­å®š (åŒæ­¥åˆ° GAS)
    async function updateNotifySettings() {
        const isLine = document.getElementById('enable-line').checked;
        const isTg = document.getElementById('enable-tg').checked;
        const status = document.getElementById('notify-status');

        localStorage.setItem('line_active', isLine);
        localStorage.setItem('tg_active', isTg);

        status.innerText = 'æ­£åœ¨åŒæ­¥è¨­å®šåˆ°é›²ç«¯...';
        status.style.color = '#666';

        try {
            await fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({
                    type: 'updateConfig',
                    line: isLine,
                    telegram: isTg
                })
            });
            status.innerText = 'âœ… é›²ç«¯è¨­å®šæ›´æ–°æˆåŠŸï¼';
            status.style.color = 'green';
        } catch (e) {
            status.innerText = 'âŒ åŒæ­¥å¤±æ•—: ' + e;
            status.style.color = 'red';
        }
    }

    // 4. æ¸…ç©ºè©¦ç®—è¡¨
    async function clearSheet() {
        if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å›å ±è³‡æ–™å—ï¼Ÿæ­¤å‹•ä½œä¸å¯æ’¤éŠ·ã€‚')) return;
        
        const status = document.getElementById('sheet-status');
        status.innerText = 'æ­£åœ¨é€£ç·šè‡³ Google è©¦ç®—è¡¨...';
        status.style.color = 'orange';
        
        try {
            await fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ type: 'clearData' })
            });
            status.innerText = 'ğŸš€ æ¸…ç©ºæŒ‡ä»¤å·²é€å‡ºï¼è³‡æ–™é è¨ˆåœ¨å¹¾ç§’å…§æ¶ˆå¤±ã€‚';
            status.style.color = 'green';
        } catch (e) {
            status.innerText = 'âŒ åŸ·è¡Œå‡ºéŒ¯ï¼š' + e;
            status.style.color = 'red';
        }
    }
</script>

</body>
</html>
